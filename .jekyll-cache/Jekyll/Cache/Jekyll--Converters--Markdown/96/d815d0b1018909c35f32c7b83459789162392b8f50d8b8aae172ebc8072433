I"÷<h1 id="how-to-recover-corrupted-git-repository">How to recover corrupted GIT repository</h1>

<h2 id="git-corrupted-really">GIT corrupted, really?</h2>

<p>Thá»±c sá»± váº¥n Ä‘á» nÃ y mÃ¬nh cÅ©ng khÃ´ng sure láº¯m lÃ  do Ä‘Ã¢u, vÃ  cÅ©ng khÃ´ng cháº¯c váº¥n Ä‘á» nÃ y cÃ³ pháº£i lÃ  corrupted hay khÃ´ng nhÆ°ng sáº½ note láº¡i má»™t chÃºt vá» case nÃ y.</p>

<h3 id="náº¡n-nhÃ¢n">Náº¡n nhÃ¢n</h3>
<p>NgÃ´ Háº£i ÄoÃ n, 1995, Android Dev. Anh ta Ä‘ang lÃ m viá»‡c trÃªn PC, Ä‘á»™t nhiÃªn tÃ²a nhÃ  bá»‹ máº¥t Ä‘iá»‡n, khi báº­t mÃ¡y láº¡i anh ta phÃ¡t hiá»‡n ra anh ta khÃ´ng thá»ƒ thá»±c hiá»‡n cÃ¡c cÃ¢u lá»‡nh git trÃªn local-repository cá»§a mÃ¬nh ná»¯a vÃ  mÃ¬nh lÃ  tháº±ng cave Ä‘Æ°á»£c gá»i support.</p>

<h3 id="phÃ¡n-Ä‘oÃ¡n">PhÃ¡n Ä‘oÃ¡n</h3>
<p>TrÆ°á»›c khi vÃ o pháº§n phÃ¡n Ä‘oÃ¡n thÃ¬ mÃ¬nh cÃ³ há»i vá» source code Ä‘Ã£ commit chÆ°a, náº¿u commit rá»“i thÃ¬ kháº£ nÄƒng recover Ä‘Æ°á»£c ráº¥t cao.
CÃ¢u há»i thá»© 2, source code Ä‘Ã³ cÃ³ quan trá»ng khÃ´ng, náº¿u cÃ³ thá»ƒ re-work trong dÆ°á»›i 30m thÃ¬ cháº¯c sáº½ khÃ´ng cÃ³ node nÃ y.</p>

<p>MÃ¬nh sáº½ káº¿t thÃºc pháº§n phÃ¡n Ä‘oÃ¡n á»Ÿ Ä‘Ã¢y vÃ¬ cháº£ cÃ³ gÃ¬ Ä‘á»ƒ phÃ¡n Ä‘oÃ¡n cáº£</p>

<h3 id="kiá»ƒm-tra-má»™t-chÃºt">Kiá»ƒm tra má»™t chÃºt.</h3>
<p>Trong khi voá»c mÃ¡y cá»§a ÄoÃ n thÃ¬ mÃ¬nh cÃ³ cá»‘ re-init repository nhÆ°ng cÃ³ váº» khÃ´ng kháº£ quan, kiá»ƒm tra má»™t lÃºc thÃ¬ cÃ³ váº» nhÆ° cÃ¡c object vÃ  ref cá»§a git váº«n cÃ²n khÃ¡ á»•n. Báº¡n cÃ³ thá»ƒ tá»± kiá»ƒm tra thÆ° má»¥c <code class="language-plaintext highlighter-rouge">.git</code> trong local repository cá»§a mÃ¬nh.</p>

<blockquote>
  <p>NhÆ° váº­y, nhÃ¬n chung kháº£ nÄƒng cao branch/commit quan trá»ng váº«n á»•n.</p>
</blockquote>

<h3 id="thá»­-recover">Thá»­ recover.</h3>

<p>MÃ¬nh cÃ³ sá»­ dá»¥ng má»™t sá»‘ cÃ¢u lá»‡nh git cÆ¡ báº£n nhÆ° <code class="language-plaintext highlighter-rouge">git log</code> hay <code class="language-plaintext highlighter-rouge">git init</code> Ä‘á»ƒ thá»­ láº¥y láº¡i commit-id nhÆ°ng khÃ´ng thÃ nh cÃ´ng.</p>

<p>Äáº¿n Ä‘Ã¢y nhÃ¬n chung báº¡n khÃ´ng thá»ƒ lÃ m gÃ¬ vá»›i repo nÃ y ná»¯a, nÃªn mÃ¬nh sáº½ chuyá»ƒn toÃ n bá»™ object cá»§a repo nÃ y sang má»™t thÆ° má»¥c khÃ¡c mÃ  vá»«a clone vá». (copy thÆ° má»¥c <code class="language-plaintext highlighter-rouge">object</code> trong <code class="language-plaintext highlighter-rouge">.git</code> cá»§a thÆ° má»¥c cÅ© sang chá»— tÆ°Æ¡ng á»©ng cá»§a thÆ° má»¥c má»›i)</p>

<blockquote>
  <p>Äáº¿n Ä‘Ã¢y báº¡n cÃ³ má»™t repository giá»‘ng vá»›i remote (chá»— mÃ  báº¡n clone vá») vÃ  cá»™ng thÃªm cÃ¡c commit mÃ  báº¡n Ä‘Ã£ commit hoáº·c Ä‘Ã£ pull vá» tá»« remote.</p>
</blockquote>

<h3 id="táº¡i-sao-láº¡i-copy-objects">Táº¡i sao láº¡i copy <code class="language-plaintext highlighter-rouge">objects</code></h3>

<p>NhÃ¬n chung náº¿u báº¡n Ä‘Ã£ commit thÃ¬ khÃ´ng sá»£ máº¥t content. Bá»Ÿi khi commit git sáº½ sinh ra cÃ¡c file <code class="language-plaintext highlighter-rouge">object</code> trong thÆ° má»¥c <code class="language-plaintext highlighter-rouge">objects</code>, cÃ´ng vá»›i log trong <code class="language-plaintext highlighter-rouge">logs</code> vÃ  má»™t sá»‘ <code class="language-plaintext highlighter-rouge">ref</code> hay <code class="language-plaintext highlighter-rouge">info</code>.</p>

<p>Object name sáº½ dÃ i 40 kÃ½ tá»± (SHA1)</p>

<p>ThÆ° má»¥c object cá»§a báº¡n sáº½ trÃ´ng nhÆ° nÃ y</p>

<p><img src="https://github.com/wingadium1/wingadium1.github.io/raw/master/img/git-objects.png" alt="alt text" /></p>

<p>TÃªn thÆ° má»¥c sáº½ lÃ  2 kÃ½ tá»± Ä‘áº§u trong 40 kÃ½ tá»±.
Trong thÆ° má»¥c sáº½ cÃ³ cÃ¡c file vá»›i tÃªn lÃ  38 kÃ½ tá»± cÃ²n láº¡i.</p>

<p>Objects sáº½ chá»©a thÃ´ng tin vá» file (changed content)
Ä‘á»ƒ xem Ä‘Æ°á»£c thÃ¬ cáº§n dÃ¹ng cÃ¢u lá»‡nh git(do git mÃ£ hÃ³a nÃªn chá»‰ git xem Ä‘c :D): <code class="language-plaintext highlighter-rouge">git cat-file</code></p>

<p><img src="https://github.com/wingadium1/wingadium1.github.io/raw/master/img/git-cat-file.png" alt="alt text" /></p>

<blockquote>
  <p>Äáº¿n Ä‘áº¥y cÃ¡c báº¡n sáº½ Ä‘áº·t cÃ¢u há»i tháº¿ git quáº£n lÃ½ cÃ¡c file thÃ nh commit nhÆ° tháº¿ nÃ o</p>
</blockquote>

<p>Tá»« cÃ¡c <code class="language-plaintext highlighter-rouge">objects</code> thÃ¬ git sáº½ dá»±ng lÃªn tree lÃ  cÃ¡c phiÃªn báº£n cá»§a thÆ° má»¥c bao gá»“m cÃ¡c <code class="language-plaintext highlighter-rouge">objects</code>.</p>

<p><img src="https://git-scm.com/book/en/v2/images/data-model-1.png" alt="alt text" /></p>

<p><img src="https://github.com/wingadium1/wingadium1.github.io/raw/master/img/git-cat-file-tree.png" alt="alt text" /></p>

<p>Cá»© tháº¿, báº±ng cÃ¡ch duyá»‡t tree, ta sáº½ cÃ³ 1 tree hoÃ n chá»‰nh gá»“m content cá»§a cáº£ má»™t phiÃªn báº£n (commit).</p>

<p>Cuá»‘i cÃ¹ng commit sáº½ bao gá»“m 1 tree</p>

<p><img src="https://github.com/wingadium1/wingadium1.github.io/raw/master/img/git-cat-file-commit.png" alt="alt text" /></p>

<blockquote>
  <p>TÃ³m láº¡i cá»© cÃ²n objects lÃ  báº¡n cÃ²n táº¥t cáº£, viá»‡c cÃ²n láº¡i lÃ  Ä‘i tÃ¬m commit-id Ä‘á»ƒ recover.</p>
</blockquote>

<h3 id="tÃ¬m-commit">TÃ¬m commit</h3>

<p>CÃ³ má»™t vÃ i chá»— Ä‘á»ƒ báº¡n cÃ³ thá»ƒ tÃ¬m GIT commit-id, thá»© nháº¥t Ä‘Ã³ lÃ  thÆ° má»¥c <code class="language-plaintext highlighter-rouge">refs</code></p>

<h4 id="refs">Refs</h4>

<p>Refs chá»‰ Ä‘Æ¡n giáº£n lÃ  references cá»§a commit. <code class="language-plaintext highlighter-rouge">Refs</code> dÃ¹ng Ä‘á»ƒ báº¡n nhá»› lastest commit báº±ng cÃ¡ch lÆ°u commit id vÃ o thÆ° má»¥c refs.</p>

<p><img src="https://github.com/wingadium1/wingadium1.github.io/raw/master/img/git-ref-head.png" alt="alt text" /></p>

<p>á» Ä‘Ã¢y lastest commit cá»§a nhÃ¡nh master Ä‘ang lÃ  <strong>b94514784b0b86e84bdd2d66903de5bf7f9722c2</strong>.</p>

<p>Váº­y nhá»› Ä‘Æ°á»£c tÃªn nhÃ¡nh lÃ  cÃ³ thá»ƒ recover láº¡i Ä‘Æ°á»£c. LÃºc nÃ y báº¡n sáº½ recover toÃ n bá»™ tree cá»§a nhÃ¡nh Ä‘Ã³ vÃ  máº·c nhiÃªn cÃ¡c commit base trÃªn commit nÃ y sáº½ cÃ³ thá»ƒ trace Ä‘Æ°á»£c.</p>

<h4 id="logs">logs</h4>

<p>Má»™t chá»— ná»¯a, toÃ n nÄƒng hÆ¡n lÃ  <code class="language-plaintext highlighter-rouge">logs</code>. Log lÆ°u láº¡i lá»‹ch sá»­ cá»§a tá»«ng nhÃ¡nh.</p>

<p><img src="https://github.com/wingadium1/wingadium1.github.io/raw/master/img/git-logs.png" alt="alt text" /></p>

<p>Báº¡n cÃ³ thá»ƒ xem mÃ¬nh Ä‘Ã£ <em>tunglamgi</em> trÃªn tá»«ng nhÃ¡nh.</p>

<blockquote>
  <p>Äáº¿n Ä‘Ã¢y báº¡n cÃ³ commit-id rá»“i viá»‡c cÃ²n láº¡i lÃ  recover báº±ng cÃ¢u lá»‡nh <code class="language-plaintext highlighter-rouge">git checkout commit-id</code></p>
</blockquote>

<h3 id="btw">Btw</h3>

<p>NhÃ¬n chung xá»­ lÃ½ máº¥y viá»‡c láº·t váº·t nÃ y khÃ¡ hay vÃ  táº¡o cho mÃ¬nh nhiá»u cÆ¡ há»™i xá»­ lÃ½ cÃ¡c thá»§ thuáº­t vá» <strong>git</strong>.</p>

<p>Anw: DÃ¹ máº¥t kÃ¬ chuyá»‡n gÃ¬ xáº£y ra Ä‘á»«ng bao giá» xÃ³a thÆ° má»¥c <strong><code class="language-plaintext highlighter-rouge">.git</code></strong>
:D</p>
:ET